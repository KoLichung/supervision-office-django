{% extends 'backboard/base.html' %} {% block content %}
          <!-- 內容 -->
          <div class="row g-3 mb-3">
            <!-- 左圖 近期訂單數 -->
            <div class="col-lg-6 ps-lg-2 mb-3">
                <div class="card h-lg-100">
                  <div class="card-header">
                    <div class="row flex-between-center">
                      <div class="col-auto">
                        <h6 class="mb-0">Total Sales</h6>
                      </div>
                    </div>
                  </div>
                  
                  <div class="card-body h-100 pe-0">
                    <!-- Find the JS file for the following chart at: src\js\charts\echarts\total-sales.js-->
                    <!-- If you are not using gulp based workflow, you can find the transpiled code at: public\assets\js\theme.js-->
                    <div class="echart-line-total-sales h-100" data-echart-responsive="true"></div>
                  </div>

                </div>
            </div>

            <!-- 右圖 近期銷售額 -->
            <div class="col-lg-6 ps-lg-2 mb-3">
                <div class="card h-lg-100">
                  <div class="card-header">
                    <div class="row flex-between-center">
                      <div class="col-auto">
                        <h6 class="mb-0">Total Sales</h6>
                      </div>
                      <div class="col-auto d-flex">
                        <select class="form-select form-select-sm select-month me-2">
                          <option value="0">January</option>
                          <option value="1">February</option>
                          <option value="2">March</option>
                          <option value="3">April</option>
                          <option value="4">May</option>
                          <option value="5">Jun</option>
                          <option value="6">July</option>
                          <option value="7">August</option>
                          <option value="8">September</option>
                          <option value="9">October</option>
                          <option value="10">November</option>
                          <option value="11">December</option>
                        </select>
                        <div class="dropdown font-sans-serif btn-reveal-trigger">
                          <button class="btn btn-link text-600 btn-sm dropdown-toggle dropdown-caret-none btn-reveal" type="button" id="dropdown-total-sales" data-bs-toggle="dropdown" data-boundary="viewport" aria-haspopup="true" aria-expanded="false"><span class="fas fa-ellipsis-h fs--2"></span></button>
                          <div class="dropdown-menu dropdown-menu-end border py-2" aria-labelledby="dropdown-total-sales"><a class="dropdown-item" href="#!">View</a><a class="dropdown-item" href="#!">Export</a>
                            <div class="dropdown-divider"></div><a class="dropdown-item text-danger" href="#!">Remove</a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="card-body h-100 pe-0">
                    <!-- Find the JS file for the following chart at: src\js\charts\echarts\total-sales.js-->
                    <!-- If you are not using gulp based workflow, you can find the transpiled code at: public\assets\js\theme.js-->
                    <div class="echart-line-total-sales h-100" data-echart-responsive="true"></div>
                  </div>
                </div>
            </div>

            <!-- 本月銷售排行 -->
            <div class="col-lg-3 ps-lg-2 mb-3">
                <div class="card h-lg-100">

                    <div class="table-responsive scrollbar">
                        <table class="table table-striped overflow-hidden">

                          <thead>
                            <tr class="btn-reveal-trigger">
                              <th scope="col">本月銷售排行</th>
                              <th scope="col"></th>
                            </tr>
                          </thead>

                          <tbody>
                            {% for product in productRank %}
                              <tr class="btn-reveal-trigger">
                                <td>{{product.name}}</td>
                                <td class="text-end">{{product.week_sum_nums}}</td>
                              </tr>                         
                            {% endfor %}
                          </tbody>

                        </table>
                    </div>
                </div>
            </div>

            <!-- 未處理訂單 -->
            <div class="col-lg-9 ps-lg-2 mb-3">
                <div class="card h-lg-100">
                    <div class="table-responsive scrollbar">
                        <table class="table table-striped overflow-hidden">
                          <thead>
                            <tr class="btn-reveal-trigger">
                              <th colspan="6">未處理訂單 ({{UndealtOrdersNum}})</th>
                            </tr>
                          </thead>

                          <tbody>
                            {% for order in orders %}
                                <tr class="btn-reveal-trigger">
                                  <td>{{order.createDate}}</td>
                                  <td >{{order.user}}</td>
                                  <td>{{order.user.phone}}</td>
                                  <td>{{order.supervisionOffice}}</td>
                                  <td>＄{{order.orderMoney}}</td>
                                  <td class="text-end">
                                    <div class="dropdown font-sans-serif position-static">   
                                          <input class="btn btn-warning btn-link text-white btn-sm" type="button" value="查看" onclick="location.href='{% url 'order_detail' %}?IdOrder={{order.id}}'">
                                    </div>
                                  </td>
                                </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                    </div>

                </div>

            </div>

            <script>
              var sum = {{UndealtOrdersNum}} * 10
              var totalSalesInit = function totalSalesInit() {
                var ECHART_LINE_TOTAL_SALES = '.echart-line-total-sales';
                var SELECT_MONTH = '.select-month';
                var $echartsLineTotalSales = document.querySelector(ECHART_LINE_TOTAL_SALES);
                var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              
                function getFormatter(params) {
                  var _params$ = params[0],
                      name = _params$.name,
                      value = _params$.value;
                  var date = new Date(name);
                  return "".concat(months[0], " ").concat(date.getDate(), ", ").concat(value);
                }
              
                if ($echartsLineTotalSales) {
                  // Get options from data attribute
                  var userOptions = utils.getData($echartsLineTotalSales, 'options');
                  var chart = window.echarts.init($echartsLineTotalSales);
                  var monthsnumber = [[sum, 20, 10, 80, 65, 130, 120, 100, 30, 40, 30, 70], [100, 70, 80, 50, 120, 100, 130, 140, 90, 100, 40, 50], [80, 50, 60, 40, 60, 120, 100, 130, 60, 80, 50, 60], [70, 80, 100, 70, 90, 60, 80, 130, 40, 60, 50, 80], [90, 40, 80, 80, 100, 140, 100, 130, 90, 60, 70, 50], [80, 60, 80, 60, 40, 100, 120, 100, 30, 40, 30, 70], [20, 40, 20, 50, 70, 60, 110, 80, 90, 30, 50, 50], [60, 70, 30, 40, 80, 140, 80, 140, 120, 130, 100, 110], [90, 90, 40, 60, 40, 110, 90, 110, 60, 80, 60, 70], [50, 80, 50, 80, 50, 80, 120, 80, 50, 120, 110, 110], [60, 90, 60, 70, 40, 70, 100, 140, 30, 40, 30, 70], [20, 40, 20, 50, 30, 80, 120, 100, 30, 40, 30, 70]];
              
                  var getDefaultOptions = function getDefaultOptions() {
                    return {
                      color: utils.getGrays()['100'],
                      tooltip: {
                        trigger: 'axis',
                        padding: [7, 10],
                        backgroundColor: utils.getGrays()['100'],
                        borderColor: utils.getGrays()['300'],
                        textStyle: {
                          color: utils.getColors().dark
                        },
                        borderWidth: 1,
                        formatter: function formatter(params) {
                          return getFormatter(params);
                        },
                        transitionDuration: 0,
                        position: function position(pos, params, dom, rect, size) {
                          return getPosition(pos, params, dom, rect, size);
                        }
                      },
                      xAxis: {
                        type: 'category',
                        data: ['2019-01-05', '2019-01-06', '2019-01-07', '2019-01-08', '2019-01-09', '2019-01-10', '2019-01-11', '2019-01-12', '2019-01-13', '2019-01-14', '2019-01-15', '2019-01-16'],
                        boundaryGap: false,
                        axisPointer: {
                          lineStyle: {
                            color: utils.getGrays()['300'],
                            type: 'dashed'
                          }
                        },
                        splitLine: {
                          show: false
                        },
                        axisLine: {
                          lineStyle: {
                            // color: utils.getGrays()['300'],
                            color: utils.rgbaColor('#000', 0.01),
                            type: 'dashed'
                          }
                        },
                        axisTick: {
                          show: false
                        },
                        axisLabel: {
                          color: utils.getGrays()['400'],
                          formatter: function formatter(value) {
                            var date = new Date(value);
                            return "".concat(months[date.getMonth()], " ").concat(date.getDate());
                          },
                          margin: 15
                        }
                      },
                      yAxis: {
                        type: 'value',
                        axisPointer: {
                          show: false
                        },
                        splitLine: {
                          lineStyle: {
                            color: utils.getGrays()['300'],
                            type: 'dashed'
                          }
                        },
                        boundaryGap: false,
                        axisLabel: {
                          show: true,
                          color: utils.getGrays()['400'],
                          margin: 15
                        },
                        axisTick: {
                          show: false
                        },
                        axisLine: {
                          show: false
                        }
                      },
                      series: [{
                        type: 'line',
                        data: monthsnumber[0],
                        lineStyle: {
                          color: utils.getColors().primary
                        },
                        itemStyle: {
                          borderColor: utils.getColors().primary,
                          borderWidth: 2
                        },
                        symbol: 'circle',
                        symbolSize: 10,
                        smooth: false,
                        hoverAnimation: true,
                        areaStyle: {
                          color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                              offset: 0,
                              color: utils.rgbaColor(utils.getColors().primary, 0.2)
                            }, {
                              offset: 1,
                              color: utils.rgbaColor(utils.getColors().primary, 0)
                            }]
                          }
                        }
                      }],
                      grid: {
                        right: '28px',
                        left: '40px',
                        bottom: '15%',
                        top: '5%'
                      }
                    };
                  };
              
                  echartSetOption(chart, userOptions, getDefaultOptions); // Change chart options accordiong to the selected month
              
                  var monthSelect = document.querySelector(SELECT_MONTH);
              
                  if (monthSelect) {
                    monthSelect.addEventListener('change', function (e) {
                      var month = e.currentTarget.value;
                      var data = monthsnumber[month];
                      chart.setOption({
                        tooltip: {
                          formatter: function formatter(params) {
                            var _params$2 = params[0],
                                name = _params$2.name,
                                value = _params$2.value;
                            var date = new Date(name);
                            return "".concat(months[month], " ").concat(date.getDate(), ", ").concat(value);
                          }
                        },
                        xAxis: {
                          axisLabel: {
                            formatter: function formatter(value) {
                              var date = new Date(value);
                              return "".concat(months[month], " ").concat(date.getDate());
                            },
                            margin: 15
                          }
                        },
                        series: [{
                          data: data
                        }]
                      });
                    });
                  }
                }
              };
            </script>

{% endblock %}